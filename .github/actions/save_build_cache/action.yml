name: 'Save Build Cache'
description: 'Adjusts artifact timestamps and saves build cache'

inputs:
  cache-key:
    description: 'Cache key from restore_build_cache action output'
    required: true
  cache-paths:
    description: 'Cache paths from restore_build_cache action output'
    required: true
  build-output-dir:
    description: 'Build output directory path'
    required: true
    default: 'build'
  repo-path:
    description: 'Path to the repository (relative to workspace root)'
    required: false
    default: '.'

runs:
  using: composite
  steps:
    - name: Adjust artifact timestamps using ninja dependency info
      shell: bash
      working-directory: ${{ inputs.repo-path }}
      run: |
        python3 $GITHUB_ACTION_PATH/adjust_artifact_timestamps.py ${{ inputs.build-output-dir }}

    - name: Save build cache
      uses: actions/cache/save@v4
      if: always()
      with:
        path: ${{ inputs.cache-paths }}
        key: ${{ inputs.cache-key }}
